<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker - IndexedDB</title>
</head>
<body>

<h2>Expense Tracker</h2>

Title:
<input type="text" id="title"><br><br>

Amount:
<input type="number" id="amount"><br><br>

Date:
<input type="date" id="date"><br><br>

<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>

<h3>Expense List</h3>
<ul id="expenseList"></ul>

<script>

let db;

// 1️⃣ Open Database
let request = indexedDB.open("ExpenseDB", 1);

request.onupgradeneeded = function(event) {
    db = event.target.result;

    // CREATE TABLE (Object Store)
    let objectStore = db.createObjectStore("expenses", {
        keyPath: "id",
        autoIncrement: true
    });

    objectStore.createIndex("title", "title", { unique: false });
};

request.onsuccess = function(event) {
    db = event.target.result;
    console.log("Database opened successfully");
};

request.onerror = function(event) {
    console.log("Database error: " + event.target.errorCode);
};


// 2️⃣ INSERT (Add Expense)
function addExpense() {

    let title = document.getElementById("title").value;
    let amount = document.getElementById("amount").value;
    let date = document.getElementById("date").value;

    let transaction = db.transaction(["expenses"], "readwrite");

    transaction.onerror = function() {
        alert("Transaction failed");
    };

    let store = transaction.objectStore("expenses");

    let expense = {
        title: title,
        amount: amount,
        date: date
    };

    let addRequest = store.add(expense);

    addRequest.onsuccess = function() {
        alert("Expense Added Successfully");
    };

    addRequest.onerror = function() {
        alert("Error Adding Expense");
    };
}


// 3️⃣ SELECT (View Expenses)
function viewExpenses() {

    let list = document.getElementById("expenseList");
    list.innerHTML = "";

    let transaction = db.transaction(["expenses"], "readonly");
    let store = transaction.objectStore("expenses");

    let request = store.openCursor();

    request.onsuccess = function(event) {
        let cursor = event.target.result;

        if (cursor) {

            let li = document.createElement("li");
            li.innerHTML = 
                cursor.value.title + " - ₹" +
                cursor.value.amount + " - " +
                cursor.value.date +
                " <button onclick='deleteExpense(" + cursor.value.id + ")'>Delete</button>";

            list.appendChild(li);

            cursor.continue();
        }
    };

    request.onerror = function() {
        alert("Error fetching data");
    };
}


// 4️⃣ DELETE
function deleteExpense(id) {

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    let deleteRequest = store.delete(id);

    deleteRequest.onsuccess = function() {
        alert("Deleted Successfully");
        viewExpenses();
    };

    deleteRequest.onerror = function() {
        alert("Delete Failed");
    };
}

</script>

</body>
</html>